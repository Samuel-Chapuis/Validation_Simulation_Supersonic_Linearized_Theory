\lstnewenvironment{pycode}[1][]{
  \lstset{
    language=Python,
    basicstyle=\small\ttfamily\normalfont,
    numbers=left,
    xleftmargin=2em,
    backgroundcolor=\color{gray!20},
    columns=fullflexible,       % Makes spaces appear normally
    keepspaces=true,            % Keeps spaces in strings like 'a    b'
    showstringspaces=false,     % Avoids visual markers for spaces in strings
    tabsize=4,                  % Define tab width
    #1
  }
}{}
