\lstnewenvironment{pycode}[1][]{
  \lstset{
    language=Python,
    basicstyle=\small\ttfamily\normalfont,
    numbers=left,
    xleftmargin=2em,
    backgroundcolor=\color{gray!20},
    #1
  }
}{}